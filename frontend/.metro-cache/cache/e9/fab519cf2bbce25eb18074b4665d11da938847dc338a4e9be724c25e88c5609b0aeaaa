{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/asyncIterator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"iAa+RToycgxigMSWyQzterF69/I=","exportNames":["*"],"imports":1}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":24},"end":{"line":2,"column":61,"index":85}}],"key":"NIaSEHO1E48gsZc7jH9Ex1xTHgE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"streamedQuery\", {\n    enumerable: true,\n    get: function () {\n      return streamedQuery;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _babelRuntimeHelpersAsyncIterator = require(_dependencyMap[1], \"@babel/runtime/helpers/asyncIterator\");\n  var _asyncIterator = _interopDefault(_babelRuntimeHelpersAsyncIterator);\n  var _utilsJs = require(_dependencyMap[2], \"./utils.js\");\n  // src/streamedQuery.ts\n\n  function streamedQuery(_ref) {\n    var streamFn = _ref.streamFn,\n      _ref$refetchMode = _ref.refetchMode,\n      refetchMode = _ref$refetchMode === void 0 ? \"reset\" : _ref$refetchMode,\n      _ref$reducer = _ref.reducer,\n      reducer = _ref$reducer === void 0 ? (items, chunk) => (0, _utilsJs.addToEnd)(items, chunk) : _ref$reducer,\n      _ref$initialValue = _ref.initialValue,\n      initialValue = _ref$initialValue === void 0 ? [] : _ref$initialValue;\n    return /*#__PURE__*/function () {\n      var _ref2 = (0, _asyncToGenerator.default)(function* (context) {\n        var query = context.client.getQueryCache().find({\n          queryKey: context.queryKey,\n          exact: true\n        });\n        var isRefetch = !!query && query.state.data !== void 0;\n        if (isRefetch && refetchMode === \"reset\") {\n          query.setState({\n            status: \"pending\",\n            data: void 0,\n            error: null,\n            fetchStatus: \"fetching\"\n          });\n        }\n        var result = initialValue;\n        var cancelled = false;\n        var streamFnContext = (0, _utilsJs.addConsumeAwareSignal)({\n          client: context.client,\n          meta: context.meta,\n          queryKey: context.queryKey,\n          pageParam: context.pageParam,\n          direction: context.direction\n        }, () => context.signal, () => cancelled = true);\n        var stream = yield streamFn(streamFnContext);\n        var isReplaceRefetch = isRefetch && refetchMode === \"replace\";\n        var _iteratorAbruptCompletion = false;\n        var _didIteratorError = false;\n        var _iteratorError;\n        try {\n          var _loop = function* () {\n            var chunk = _step.value;\n            {\n              if (cancelled) {\n                return 1; // break\n              }\n              if (isReplaceRefetch) {\n                result = reducer(result, chunk);\n              } else {\n                context.client.setQueryData(context.queryKey, prev => reducer(prev === void 0 ? initialValue : prev, chunk));\n              }\n            }\n          };\n          for (var _iterator = (0, _asyncIterator.default)(stream), _step; _iteratorAbruptCompletion = !(_step = yield _iterator.next()).done; _iteratorAbruptCompletion = false) {\n            if (yield* _loop()) break;\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (_iteratorAbruptCompletion && _iterator.return != null) {\n              yield _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n        if (isReplaceRefetch && !cancelled) {\n          context.client.setQueryData(context.queryKey, result);\n        }\n        return context.client.getQueryData(context.queryKey) ?? initialValue;\n      });\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n  }\n});","lineCount":103,"map":[[12,2,54,0,"Object"],[12,8,54,0],[12,9,54,0,"defineProperty"],[12,23,54,0],[12,24,54,0,"exports"],[12,31,54,0],[13,4,54,0,"enumerable"],[13,14,54,0],[14,4,54,0,"get"],[14,7,54,0],[14,18,54,0,"get"],[14,19,54,0],[15,6,54,0],[15,13,55,2,"streamedQuery"],[15,26,55,15],[16,4,55,15],[17,2,55,15],[18,2,56,2],[18,6,56,2,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,56,2],[18,45,56,2,"require"],[18,52,56,2],[18,53,56,2,"_dependencyMap"],[18,67,56,2],[19,2,56,2],[19,6,56,2,"_asyncToGenerator"],[19,23,56,2],[19,26,56,2,"_interopDefault"],[19,41,56,2],[19,42,56,2,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,56,2],[20,2,56,2],[20,6,56,2,"_babelRuntimeHelpersAsyncIterator"],[20,39,56,2],[20,42,56,2,"require"],[20,49,56,2],[20,50,56,2,"_dependencyMap"],[20,64,56,2],[21,2,56,2],[21,6,56,2,"_asyncIterator"],[21,20,56,2],[21,23,56,2,"_interopDefault"],[21,38,56,2],[21,39,56,2,"_babelRuntimeHelpersAsyncIterator"],[21,72,56,2],[22,2,2,0],[22,6,2,0,"_utilsJs"],[22,14,2,0],[22,17,2,0,"require"],[22,24,2,0],[22,25,2,0,"_dependencyMap"],[22,39,2,0],[23,2,1,0],[25,2,3,0],[25,11,3,9,"streamedQuery"],[25,24,3,22,"streamedQuery"],[25,25,3,22,"_ref"],[25,29,3,22],[25,31,8,3],[26,4,8,3],[26,8,4,2,"streamFn"],[26,16,4,10],[26,19,4,10,"_ref"],[26,23,4,10],[26,24,4,2,"streamFn"],[26,32,4,10],[27,6,4,10,"_ref$refetchMode"],[27,22,4,10],[27,25,4,10,"_ref"],[27,29,4,10],[27,30,5,2,"refetchMode"],[27,41,5,13],[28,6,5,2,"refetchMode"],[28,17,5,13],[28,20,5,13,"_ref$refetchMode"],[28,36,5,13],[28,50,5,16],[28,57,5,23],[28,60,5,23,"_ref$refetchMode"],[28,76,5,23],[29,6,5,23,"_ref$reducer"],[29,18,5,23],[29,21,5,23,"_ref"],[29,25,5,23],[29,26,6,2,"reducer"],[29,33,6,9],[30,6,6,2,"reducer"],[30,13,6,9],[30,16,6,9,"_ref$reducer"],[30,28,6,9],[30,42,6,12],[30,43,6,13,"items"],[30,48,6,18],[30,50,6,20,"chunk"],[30,55,6,25],[30,60,6,30],[30,64,6,30,"addToEnd"],[30,72,6,38],[30,73,6,38,"addToEnd"],[30,81,6,38],[30,83,6,39,"items"],[30,88,6,44],[30,90,6,46,"chunk"],[30,95,6,51],[30,96,6,52],[30,99,6,52,"_ref$reducer"],[30,111,6,52],[31,6,6,52,"_ref$initialValue"],[31,23,6,52],[31,26,6,52,"_ref"],[31,30,6,52],[31,31,7,2,"initialValue"],[31,43,7,14],[32,6,7,2,"initialValue"],[32,18,7,14],[32,21,7,14,"_ref$initialValue"],[32,38,7,14],[32,52,7,17],[32,54,7,19],[32,57,7,19,"_ref$initialValue"],[32,74,7,19],[33,4,9,2],[34,6,9,2],[34,10,9,2,"_ref2"],[34,15,9,2],[34,22,9,2,"_asyncToGenerator"],[34,39,9,2],[34,40,9,2,"default"],[34,47,9,2],[34,49,9,9],[34,60,9,16,"context"],[34,67,9,23],[34,69,9,28],[35,8,10,4],[35,12,10,10,"query"],[35,17,10,15],[35,20,10,18,"context"],[35,27,10,25],[35,28,10,26,"client"],[35,34,10,32],[35,35,10,33,"getQueryCache"],[35,48,10,46],[35,49,10,47],[35,50,10,48],[35,51,10,49,"find"],[35,55,10,53],[35,56,10,54],[36,10,10,56,"queryKey"],[36,18,10,64],[36,20,10,66,"context"],[36,27,10,73],[36,28,10,74,"queryKey"],[36,36,10,82],[37,10,10,84,"exact"],[37,15,10,89],[37,17,10,91],[38,8,10,96],[38,9,10,97],[38,10,10,98],[39,8,11,4],[39,12,11,10,"isRefetch"],[39,21,11,19],[39,24,11,22],[39,25,11,23],[39,26,11,24,"query"],[39,31,11,29],[39,35,11,33,"query"],[39,40,11,38],[39,41,11,39,"state"],[39,46,11,44],[39,47,11,45,"data"],[39,51,11,49],[39,56,11,54],[39,61,11,59],[39,62,11,60],[40,8,12,4],[40,12,12,8,"isRefetch"],[40,21,12,17],[40,25,12,21,"refetchMode"],[40,36,12,32],[40,41,12,37],[40,48,12,44],[40,50,12,46],[41,10,13,6,"query"],[41,15,13,11],[41,16,13,12,"setState"],[41,24,13,20],[41,25,13,21],[42,12,14,8,"status"],[42,18,14,14],[42,20,14,16],[42,29,14,25],[43,12,15,8,"data"],[43,16,15,12],[43,18,15,14],[43,23,15,19],[43,24,15,20],[44,12,16,8,"error"],[44,17,16,13],[44,19,16,15],[44,23,16,19],[45,12,17,8,"fetchStatus"],[45,23,17,19],[45,25,17,21],[46,10,18,6],[46,11,18,7],[46,12,18,8],[47,8,19,4],[48,8,20,4],[48,12,20,8,"result"],[48,18,20,14],[48,21,20,17,"initialValue"],[48,33,20,29],[49,8,21,4],[49,12,21,8,"cancelled"],[49,21,21,17],[49,24,21,20],[49,29,21,25],[50,8,22,4],[50,12,22,10,"streamFnContext"],[50,27,22,25],[50,30,22,28],[50,34,22,28,"addConsumeAwareSignal"],[50,42,22,49],[50,43,22,49,"addConsumeAwareSignal"],[50,64,22,49],[50,66,23,6],[51,10,24,8,"client"],[51,16,24,14],[51,18,24,16,"context"],[51,25,24,23],[51,26,24,24,"client"],[51,32,24,30],[52,10,25,8,"meta"],[52,14,25,12],[52,16,25,14,"context"],[52,23,25,21],[52,24,25,22,"meta"],[52,28,25,26],[53,10,26,8,"queryKey"],[53,18,26,16],[53,20,26,18,"context"],[53,27,26,25],[53,28,26,26,"queryKey"],[53,36,26,34],[54,10,27,8,"pageParam"],[54,19,27,17],[54,21,27,19,"context"],[54,28,27,26],[54,29,27,27,"pageParam"],[54,38,27,36],[55,10,28,8,"direction"],[55,19,28,17],[55,21,28,19,"context"],[55,28,28,26],[55,29,28,27,"direction"],[56,8,29,6],[56,9,29,7],[56,11,30,6],[56,17,30,12,"context"],[56,24,30,19],[56,25,30,20,"signal"],[56,31,30,26],[56,33,31,6],[56,39,31,12,"cancelled"],[56,48,31,21],[56,51,31,24],[56,55,32,4],[56,56,32,5],[57,8,33,4],[57,12,33,10,"stream"],[57,18,33,16],[57,27,33,25,"streamFn"],[57,35,33,33],[57,36,33,34,"streamFnContext"],[57,51,33,49],[57,52,33,50],[58,8,34,4],[58,12,34,10,"isReplaceRefetch"],[58,28,34,26],[58,31,34,29,"isRefetch"],[58,40,34,38],[58,44,34,42,"refetchMode"],[58,55,34,53],[58,60,34,58],[58,69,34,67],[59,8,34,68],[59,12,34,68,"_iteratorAbruptCompletion"],[59,37,34,68],[60,8,34,68],[60,12,34,68,"_didIteratorError"],[60,29,34,68],[61,8,34,68],[61,12,34,68,"_iteratorError"],[61,26,34,68],[62,8,34,68],[63,10,34,68],[63,14,34,68,"_loop"],[63,19,34,68],[63,32,34,68,"_loop"],[63,33,34,68],[63,35,35,38],[64,12,35,38],[64,16,35,21,"chunk"],[64,21,35,26],[64,24,35,26,"_step"],[64,29,35,26],[64,30,35,26,"value"],[64,35,35,26],[65,12,35,26],[66,14,36,6],[66,18,36,10,"cancelled"],[66,27,36,19],[66,29,36,21],[67,16,36,21],[68,14,38,6],[69,14,39,6],[69,18,39,10,"isReplaceRefetch"],[69,34,39,26],[69,36,39,28],[70,16,40,8,"result"],[70,22,40,14],[70,25,40,17,"reducer"],[70,32,40,24],[70,33,40,25,"result"],[70,39,40,31],[70,41,40,33,"chunk"],[70,46,40,38],[70,47,40,39],[71,14,41,6],[71,15,41,7],[71,21,41,13],[72,16,42,8,"context"],[72,23,42,15],[72,24,42,16,"client"],[72,30,42,22],[72,31,42,23,"setQueryData"],[72,43,42,35],[72,44,43,10,"context"],[72,51,43,17],[72,52,43,18,"queryKey"],[72,60,43,26],[72,62,44,11,"prev"],[72,66,44,15],[72,70,44,20,"reducer"],[72,77,44,27],[72,78,44,28,"prev"],[72,82,44,32],[72,87,44,37],[72,92,44,42],[72,93,44,43],[72,96,44,46,"initialValue"],[72,108,44,58],[72,111,44,61,"prev"],[72,115,44,65],[72,117,44,67,"chunk"],[72,122,44,72],[72,123,45,8],[72,124,45,9],[73,14,46,6],[74,12,46,7],[75,10,47,4],[75,11,47,5],[76,10,35,4],[76,19,35,4,"_iterator"],[76,28,35,4],[76,35,35,4,"_asyncIterator"],[76,49,35,4],[76,50,35,4,"default"],[76,57,35,4],[76,59,35,30,"stream"],[76,65,35,36],[76,68,35,36,"_step"],[76,73,35,36],[76,75,35,36,"_iteratorAbruptCompletion"],[76,100,35,36],[76,105,35,36,"_step"],[76,110,35,36],[76,119,35,36,"_iterator"],[76,128,35,36],[76,129,35,36,"next"],[76,133,35,36],[76,137,35,36,"done"],[76,141,35,36],[76,143,35,36,"_iteratorAbruptCompletion"],[76,168,35,36],[77,12,35,36],[77,23,35,36,"_loop"],[77,28,35,36],[77,32,37,8],[78,10,37,14],[79,8,47,5],[79,17,47,5,"err"],[79,20,47,5],[80,10,47,5,"_didIteratorError"],[80,27,47,5],[81,10,47,5,"_iteratorError"],[81,24,47,5],[81,27,47,5,"err"],[81,30,47,5],[82,8,47,5],[83,10,47,5],[84,12,47,5],[84,16,47,5,"_iteratorAbruptCompletion"],[84,41,47,5],[84,45,47,5,"_iterator"],[84,54,47,5],[84,55,47,5,"return"],[84,61,47,5],[85,14,47,5],[85,20,47,5,"_iterator"],[85,29,47,5],[85,30,47,5,"return"],[85,36,47,5],[86,12,47,5],[87,10,47,5],[88,12,47,5],[88,16,47,5,"_didIteratorError"],[88,33,47,5],[89,14,47,5],[89,20,47,5,"_iteratorError"],[89,34,47,5],[90,12,47,5],[91,10,47,5],[92,8,47,5],[93,8,48,4],[93,12,48,8,"isReplaceRefetch"],[93,28,48,24],[93,32,48,28],[93,33,48,29,"cancelled"],[93,42,48,38],[93,44,48,40],[94,10,49,6,"context"],[94,17,49,13],[94,18,49,14,"client"],[94,24,49,20],[94,25,49,21,"setQueryData"],[94,37,49,33],[94,38,49,34,"context"],[94,45,49,41],[94,46,49,42,"queryKey"],[94,54,49,50],[94,56,49,52,"result"],[94,62,49,58],[94,63,49,59],[95,8,50,4],[96,8,51,4],[96,15,51,11,"context"],[96,22,51,18],[96,23,51,19,"client"],[96,29,51,25],[96,30,51,26,"getQueryData"],[96,42,51,38],[96,43,51,39,"context"],[96,50,51,46],[96,51,51,47,"queryKey"],[96,59,51,55],[96,60,51,56],[96,64,51,60,"initialValue"],[96,76,51,72],[97,6,52,2],[97,7,52,3],[98,6,52,3],[98,23,52,3,"_x"],[98,25,52,3],[99,8,52,3],[99,15,52,3,"_ref2"],[99,20,52,3],[99,21,52,3,"apply"],[99,26,52,3],[99,33,52,3,"arguments"],[99,42,52,3],[100,6,52,3],[101,4,52,3],[102,2,53,0],[103,0,53,1],[103,3]],"functionMap":{"names":["<global>","streamedQuery","<anonymous>","addConsumeAwareSignal$argument_1","addConsumeAwareSignal$argument_2","context.client.setQueryData$argument_1"],"mappings":"AAA;ACE;YCG,wCD;SCG;MCqB,oBD;MEC,sBF;UGa,+DH;GDQ;CDC"},"hasCjsExports":false},"type":"js/module"}]}